<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>命名空间配置管理</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='nacos.css') }}">
    <style>
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 20px;
        }
        .select-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .table-container {
            margin-top: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal.is-active {
            display: flex;
        }
        .modal-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
        }
        .pagination {
            margin-top: 20px;
            justify-content: center;
        }
        .pagination-list .pagination-ellipsis {
            pointer-events: none;
        }
        .pagination-size {
            margin-top: 20px;
            text-align: right;
        }
    </style>
</head>
<body>
    <section id="app" class="section">
        <div class="container">
            <h1 class="title">命名空间: [[ namespace_id ]] 配置管理</h1>

            <!-- 操作按钮 -->
            <div class="action-buttons">
                <button class="button is-primary" @click="openCreateModal">新增配置</button>
                <button class="button is-link" @click="goBack">返回命名空间列表</button>
            </div>

            <!-- 组选择和搜索 -->
            <div class="select-group">
                <div class="field is-expanded">
                    <label class="label">选择组</label>
                    <div class="control">
                        <div class="select is-fullwidth" :class="{ 'is-loading': loadingGroups }">
                            <select v-model="selectedGroup" @change="onGroupChange">
                                <option value="" disabled selected>请选择组</option>
                                <option v-for="group in groups" :value="group">[[ group ]]</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="field is-expanded">
                    <label class="label">搜索或输入数据 ID</label>
                    <div class="control">
                        <input v-model="searchDataId" class="input" type="text" placeholder="输入数据 ID 进行搜索">
                    </div>
                </div>

                <button class="button is-info" @click="searchConfigs">搜索</button>
            </div>

            <!-- 配置展示表格 -->
            <div class="table-container">
                <table class="table is-fullwidth is-striped is-hoverable">
                    <thead>
                        <tr>
                            <th>Namespace</th>
                            <th>Group</th>
                            <th>Data ID</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="config in paginatedConfigs" :key="config.id">
                            <td>[[ namespace_id ]]</td>
                            <td>[[ config.group ]]</td>
                            <td>[[ config.dataId ]]</td>
                            <td>
                                <button class="button is-small is-info" @click="viewDetails(config)">详情</button>
                                <button class="button is-small is-warning" @click="editConfig(config)">编辑</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 分页组件 -->
            <nav class="pagination is-centered" role="navigation" aria-label="pagination" v-if="totalPages >= 1">
                <a class="pagination-previous" :disabled="currentPage === 1" @click="changePage(currentPage - 1)">上一页</a>
                <a class="pagination-next" :disabled="currentPage === totalPages" @click="changePage(currentPage + 1)">下一页</a>
                <ul class="pagination-list">
                    <li v-if="currentPage > 1">
                        <a class="pagination-link" @click="changePage(1)">1</a>
                    </li>
                    <li v-if="currentPage > 4">
                        <span class="pagination-ellipsis">&hellip;</span>
                    </li>
                    <li v-for="page in paginationRange" :key="page">
                        <a class="pagination-link" :class="{ 'is-current': page === currentPage }" @click="changePage(page)">[[ page ]]</a>
                    </li>
                    <li v-if="currentPage < totalPages - 3">
                        <span class="pagination-ellipsis">&hellip;</span>
                    </li>
                    <li v-if="currentPage < totalPages">
                        <a class="pagination-link" @click="changePage(totalPages)">[[ totalPages ]]</a>
                    </li>
                </ul>
            </nav>

            <!-- 每页显示数量选择 -->
            <div class="pagination-size">
                <span>每页显示:</span>
                <select v-model="pageSize" @change="fetchConfigs">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
                <span>条记录</span>
            </div>

            <!-- 添加/更新配置的模态框 -->
            <div class="modal" :class="{ 'is-active': showModal }">
                <div class="modal-background"></div>
                <div class="modal-card">
                    <header class="modal-card-head">
                        <p class="modal-card-title">[[ isViewing ? '查看配置' : (isEditing ? '编辑配置' : '新增配置') ]]</p>
                        <button class="delete" aria-label="close" @click="closeCreateModal"></button>
                    </header>
                    <section class="modal-card-body">
                        <div class="field">
                            <label class="label">组</label>
                            <div class="control">
                                <input v-model="newConfig.group" class="input" type="text" :disabled="isEditing || isViewing" placeholder="输入组名称">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">数据 ID</label>
                            <div class="control">
                                <input v-model="newConfig.dataId" class="input" type="text" :disabled="isEditing || isViewing" placeholder="输入数据 ID">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">内容</label>
                            <div class="control">
                                <textarea v-model="newConfig.content" class="textarea" :disabled="isViewing" placeholder="输入配置内容"></textarea>
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">描述</label>
                            <div class="control">
                                <input v-model="newConfig.desc" class="input" type="text" :disabled="isViewing" placeholder="输入描述">
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">类型</label>
                            <div class="control">
                                <div class="select">
                                    <select v-model="newConfig.type" :disabled="isViewing">
                                        <option value="yaml">YAML</option>
                                        <option value="properties">Properties</option>
                                        <option value="json">JSON</option>
                                        <option value="xml">XML</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>
                    <footer class="modal-card-foot">
                        <button class="button is-primary" @click="submitConfig" v-if="!isViewing">提交</button>
                        <button class="button" @click="closeCreateModal">关闭</button>
                    </footer>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js"></script>
    <script src="{{ url_for('static', filename='namespace_details.js') }}"></script>
</body>
</html>
